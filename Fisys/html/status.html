<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filamentstatus</title>
  <link rel="stylesheet" href="/static/assets/style.css" />
  <meta name="theme-color" content="#222">
  <style>
    html {
      background-color: #222;
    }
    html {
      height: 100%;
    }

    body {
      min-height: 100%;
      position: relative;
      margin: 0;
      padding: 0;
      z-index: 0;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(270deg, #111, #222, #333, #222, #111);
      background-size: 400% 400%;
      animation: animated-bg 20s linear infinite;
      z-index: -1;
      pointer-events: none;
    }

    @keyframes animated-bg {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 0%; }
      100% { background-position: 0% 0%; }
    }
    .filament-card {
      border-radius: 8px;
      padding: 10px;
      margin: 10px;
      background-color: #222;
      color: white;
      display: inline-block;
      width: 200px;
      vertical-align: top;
      text-align: center;
      flex: 0 0 auto;
    }
    .stat-box {
      background-color: #1f1f1f;
      border-radius: 12px;
      margin-top: 60px;
      padding: 0.8em 3em;
      color: #ccc;
      text-align: center;
    }
    .filament-card img {
      width: calc(100% - 12px);
      aspect-ratio: 1 / 1;
      height: auto;
      object-fit: cover;
      border-radius: 25px;
      padding: 0 6px;
      margin-top: 6px;
    }
    .logo {
      position: fixed;
      top: 0em;
      left: 2em;
      z-index: 1000;
    }
    .logo img {
      height: 100px;
      width: auto;
    }
    #leer-container,
    #fastleer-container {
      background-color: #181818;
      border-radius: 10px;
      padding: 1em;
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      margin-bottom: 2em;
    }
    .top-bar {
      position: fixed;
      top: 13px;
      left: 0;
      width: 170px;
      height: 70px;
      background-color: transparent;
      z-index: 0;
      pointer-events: none;
    }

    .top-bar::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 70%, transparent 100%),
                   linear-gradient(to right, black 0%, black 90%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 30%, black 70%, transparent 100%),
                         linear-gradient(to right, black 0%, black 90%, transparent 100%);
      mask-composite: intersect;
      -webkit-mask-composite: destination-in;
    }
  </style>
</head>
<body>
  <div class="top-bar"></div>
  <div class="logo">
    <a href="/"><img src="/static/assets/Fisys Logo.png" alt="Fisys Logo"></a>
  </div>

  <main style="padding: 1em;">
    <div id="gesamt-info" style="margin: 0 auto 2em auto; display: flex; justify-content: center; gap: 1em;">
      <div class="stat-box"><p id="anzahl-typen">Typen insgesamt: ...</p></div>
      <div class="stat-box"><p id="anzahl-spulen">Spulen insgesamt: ...</p></div>
    </div>
    <h2>Gerade im Drucker</h2>
    <div id="drucker-container" style="background-color: #181818; border-radius: 10px; padding: 1em; display: flex; overflow-x: auto; white-space: nowrap; margin-bottom: 2em;"></div>
    <h2>Fast leere Typen</h2>
    <div id="fastleer-container"></div>

    <h2>Leere Typen</h2>
    <div id="leer-container"></div>
  </main>

  <script>
    async function fetchFilamentStatus() {
      const res = await fetch("/fastleere_data");

      const druckerRes = await fetch("/drucker_data");
      const druckerData = await druckerRes.json();
      const druckerContainer = document.getElementById("drucker-container");

      druckerData.forEach(filament => {
        const div = document.createElement("div");
        // Farb-Border-Logik einfÃ¼gen
        const farbe = filament.farbe?.toLowerCase().replace(/\s+/g, "") || "";
        let farbschlÃ¼ssel = "";
        if (farbe.includes("blau")) farbschlÃ¼ssel = "blau";
        else if (farbe.includes("rot")) farbschlÃ¼ssel = "rot";
        else if (farbe.includes("grau")) farbschlÃ¼ssel = "grau";
        else if (farbe.includes("magenta")) farbschlÃ¼ssel = "magenta";
        else if (farbe.includes("pink")) farbschlÃ¼ssel = "pink";
        else if (farbe.includes("cyan")) farbschlÃ¼ssel = "cyan";
        else if (farbe.includes("birke")) farbschlÃ¼ssel = "birke";
        else if (farbe.includes("gelb")) farbschlÃ¼ssel = "gelb";
        else if (farbe.includes("schwarz")) farbschlÃ¼ssel = "schwarz";
        else if (farbe.includes("weiÃŸ") || farbe.includes("weiss")) farbschlÃ¼ssel = "weiÃŸ";
        else if (farbe.includes("grÃ¼n")) farbschlÃ¼ssel = "grÃ¼n";
        else if (farbe.includes("orange")) farbschlÃ¼ssel = "orange";
        else if (farbe.includes("violett")) farbschlÃ¼ssel = "violett";
        else if (farbe.includes("silber")) farbschlÃ¼ssel = "silber";
        else if (farbe.includes("gold")) farbschlÃ¼ssel = "gold";
        else if (farbe.includes("kupfer")) farbschlÃ¼ssel = "kupfer";
        else if (farbe.includes("transparent")) farbschlÃ¼ssel = "transparent";
        else if (farbe.includes("natur")) farbschlÃ¼ssel = "natur";
        else if (farbe.includes("braun")) farbschlÃ¼ssel = "braun";
        if (farbschlÃ¼ssel) div.classList.add("border-" + farbschlÃ¼ssel);
        div.classList.add("filament-card");
        div.style.cursor = "pointer";
        div.onclick = () => {
          window.location.href = `/filamentseite?typ_id=${filament.id}`;
        };
        div.innerHTML = `
          <img src="/static/assets/images/${filament.bildname}" alt="${filament.name}" height="100" />
          <h3>${filament.name}</h3>
          <p><strong>Material:</strong> ${filament.material}</p>
          <p><strong>Farbe:</strong> ${filament.farbe}</p>
          <p><strong>Ã˜:</strong> ${filament.durchmesser} mm</p>
          <p><strong>Spulen im Drucker:</strong> ${filament.spulenanzahl}</p>
        `;
        druckerContainer.appendChild(div);
      });

      if (!druckerContainer.hasChildNodes()) {
        druckerContainer.innerHTML = "<p>Keine Typen im Drucker</p>";
      }

      const data = await res.json();
      const statsRes = await fetch("/stats");
      const stats = await statsRes.json();
      document.getElementById("anzahl-typen").textContent = `Typen insgesamt: ${stats.typen}`;
      document.getElementById("anzahl-spulen").textContent = `Spulen insgesamt: ${stats.spulen}`;
      const leerContainer = document.getElementById("leer-container");
      const fastleerContainer = document.getElementById("fastleer-container");

      data.forEach(filament => {
        const div = document.createElement("div");
        // Farb-Border-Logik einfÃ¼gen
        const farbe = filament.farbe?.toLowerCase().replace(/\s+/g, "") || "";
        let farbschlÃ¼ssel = "";
        if (farbe.includes("blau")) farbschlÃ¼ssel = "blau";
        else if (farbe.includes("rot")) farbschlÃ¼ssel = "rot";
        else if (farbe.includes("grau")) farbschlÃ¼ssel = "grau";
        else if (farbe.includes("magenta")) farbschlÃ¼ssel = "magenta";
        else if (farbe.includes("pink")) farbschlÃ¼ssel = "pink";
        else if (farbe.includes("cyan")) farbschlÃ¼ssel = "cyan";
        else if (farbe.includes("birke")) farbschlÃ¼ssel = "birke";
        else if (farbe.includes("gelb")) farbschlÃ¼ssel = "gelb";
        else if (farbe.includes("schwarz")) farbschlÃ¼ssel = "schwarz";
        else if (farbe.includes("weiÃŸ") || farbe.includes("weiss")) farbschlÃ¼ssel = "weiÃŸ";
        else if (farbe.includes("grÃ¼n")) farbschlÃ¼ssel = "grÃ¼n";
        else if (farbe.includes("orange")) farbschlÃ¼ssel = "orange";
        else if (farbe.includes("violett")) farbschlÃ¼ssel = "violett";
        else if (farbe.includes("silber")) farbschlÃ¼ssel = "silber";
        else if (farbe.includes("gold")) farbschlÃ¼ssel = "gold";
        else if (farbe.includes("kupfer")) farbschlÃ¼ssel = "kupfer";
        else if (farbe.includes("transparent")) farbschlÃ¼ssel = "transparent";
        else if (farbe.includes("natur")) farbschlÃ¼ssel = "natur";
        if (farbschlÃ¼ssel) div.classList.add("border-" + farbschlÃ¼ssel);
        div.classList.add("filament-card");
        div.style.cursor = "pointer";
        div.onclick = () => {
          window.location.href = `/filamentseite?typ_id=${filament.id}`;
        };
        div.innerHTML = `
          <img src="/static/assets/images/${filament.bildname}" alt="${filament.name}" height="100" />
          <h3>${filament.name}</h3>
          <p><strong>Material:</strong> ${filament.material}</p>
          <p><strong>Farbe:</strong> ${filament.farbe}</p>
          <p><strong>Ã˜:</strong> ${filament.durchmesser} mm</p>
          <p style="margin-top: 0.5em; font-weight: bold; color: ${filament.status === "leer" ? "red" : "gold"};">
            ${filament.status === "leer" ? "LEER" : "FAST LEER"}
          </p>
        `;
        if (filament.status === "leer") {
          leerContainer.appendChild(div);
        } else if (filament.status === "fastleer") {
          fastleerContainer.appendChild(div);
        }
      });

      if (!leerContainer.hasChildNodes()) {
        leerContainer.innerHTML = "<p>Keine leeren Typen ðŸŽ‰</p>";
      }
      if (!fastleerContainer.hasChildNodes()) {
        fastleerContainer.innerHTML = "<p>Keine fast leeren Typen ðŸŽ‰</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", fetchFilamentStatus);
  </script>
</body>
</html>